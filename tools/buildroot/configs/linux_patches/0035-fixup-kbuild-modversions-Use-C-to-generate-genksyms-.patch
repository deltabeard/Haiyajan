From 694cb1ebb191a85ec8438a7756cc511dad1b2d3a Mon Sep 17 00:00:00 2001
From: Andi Kleen <ak@linux.intel.com>
Date: Tue, 7 Jul 2020 16:21:53 -0700
Subject: [PATCH 35/38] fixup! kbuild, modversions: Use C to generate genksyms
 crc symbols

---
 scripts/link-vmlinux.sh | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/scripts/link-vmlinux.sh b/scripts/link-vmlinux.sh
index 32ec1a82a58a..d4a786a0e853 100755
--- a/scripts/link-vmlinux.sh
+++ b/scripts/link-vmlinux.sh
@@ -207,7 +207,9 @@ kallsyms_s()
 		${AR} t $i | while read j ; do readelf -s $j ; done
 	done | awk 'NF >= 8 { print "0 t " $8 } '
 	# now handle the objects
-	readelf -s `echo ${1} | sed 's/ /\n/g' | grep '\.o$'` | awk 'NF >= 8 {
+	echo ${1} | sed 's/ /\n/g' | grep '\.o$' | while read i ; do
+		readelf -s $i
+	done | awk 'NF >= 8 {
 	if ($8 !~ /Name|__gnu_lto_slim|\.c(\.[0-9a-f]+)?/) { print "0 t " $8 }
 	}'
 	else
-- 
2.28.0

